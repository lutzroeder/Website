Array.prototype.remove=function(t){for(var e=this.length;e--;)this[e]==t&&this.splice(e,1)};var Textor;!function(t){var e=function(){function t(){this._undoUnits=[]}return t.prototype.add=function(t){this._undoUnits.push(t)},t.prototype.undo=function(){for(var t=0;t<this._undoUnits.length;t++)this._undoUnits[t].undo()},t.prototype.redo=function(){for(var t=0;t<this._undoUnits.length;t++)this._undoUnits[t].redo()},Object.defineProperty(t.prototype,"isEmpty",{get:function(){if(this._undoUnits.length>0)for(var t=0;t<this._undoUnits.length;t++)if(!this._undoUnits[t].isEmpty)return!1;return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"undoUnits",{get:function(){return this._undoUnits},enumerable:!0,configurable:!0}),t.prototype.toString=function(){for(var t="Container:\n",e=0;e<this._undoUnits.length;e++)t+="\t"+this._undoUnits[e].toString()+"\n";return t},t}();t.ContainerUndoUnit=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function e(t){this._timeoutEnabled=!1,this._language=null,this._syntaxTable=[],this._textEditor=t}return Object.defineProperty(e.prototype,"language",{get:function(){return this._language},set:function(t){this._language=t},enumerable:!0,configurable:!0}),e.prototype.getStyles=function(t){return this._syntaxTable[t]?this._syntaxTable[t]:[]},e.prototype.invalidate=function(t,e,i){if(null!==this._language){this._timeoutEnabled&&(window.clearTimeout(this._timeout),this._timeoutEnabled=!1);var n=null;if(this._line=0,this._column=0,this._syntaxTable.length>0){for(var o=t.start.line,s=0;this._syntaxTable[o]&&s<this._syntaxTable[o].length&&t.start.column>this._syntaxTable[o][s].start;)s++;for(;o>=0&&s>=0;)if(s--,s<0&&(o--,s=this._syntaxTable[o]?this._syntaxTable[o].length-1:0),this._syntaxTable[o]&&this._syntaxTable[o][s]&&null!==this._syntaxTable[o][s].state){n=this._syntaxTable[o][s].state,this._line=o,this._column=this._syntaxTable[o][s].start;break}}for(this.moveRange(t.end.clone(),e.end.clone()),i.length>0&&this.clearRange(e.start,e.end),this._index=0;this._syntaxTable[this._line]&&this._index<this._syntaxTable[this._line].length&&this._column>this._syntaxTable[this._line][this._index].start;)this._index++;this._textReader=this._textEditor.createTextReader(),this._textReader.textPosition.line=this._line,this._textReader.textPosition.column=this._column,this._language.begin(this._textReader,n),this._style="text",this.window_setTimeout()}},e.prototype.window_setTimeout=function(){for(var e=(new Date).getTime()+20,i=new t.TextPosition(this._line,this._column),n=this._textReader.textPosition.line,o=this._textReader.textPosition.column;this._textReader.peek().length>0;){var s=this._language.read(),r=this._textReader.peek();if(0!==r.length&&null===s.style&&null===s.state||(0!==r.length&&s.style===this._style&&s.state===this._state&&null===s.state||(0!==r.length&&n===this._line&&o===this._column&&null===s.state||(this.addRecord(this._column,n,this._style,this._state),this._column=o),this._style=s.style,this._state=s.state),n=this._textReader.textPosition.line,o=this._textReader.textPosition.column),(new Date).getTime()>e)break}this._textReader.peek().length>0?(this._timeout=window.setTimeout(this.window_setTimeout.bind(this),100),this._timeoutEnabled=!0):this.addRecord(this._column,this._line,this._style,null),this._textEditor.invalidateRange(new t.TextRange(i,new t.TextPosition(this._line,this._column))),this._textEditor.update()},e.prototype.moveRange=function(t,e){if(t.compareTo(e)<0){for(var i=0;this._syntaxTable[t.line]&&i<this._syntaxTable[t.line].length&&t.column>this._syntaxTable[t.line][i].start;)i++;if(this._syntaxTable[t.line]){for(var n=this._syntaxTable[t.line].splice(i,this._syntaxTable[t.line].length-i),o=0;o<n.length;o++)n[o].start+=e.column-t.column;var s=e.line-t.line;if(s>0){for(var r=new Array(s),o=0;o<s;o++)r[o]=i>0?[{style:this._syntaxTable[t.line][i-1].style,state:null,start:0}]:[];var a=this._syntaxTable.splice(t.line+1,this._syntaxTable.length-t.line+1);this._syntaxTable=this._syntaxTable.concat(r,a)}this._syntaxTable[e.line]=this._syntaxTable[e.line].concat(n)}}else if(t.compareTo(e)>0){var i=0;if(t.line>=this._syntaxTable.length)t.line=this._syntaxTable.length-1,i=this._syntaxTable[t.line].length-1;else for(;this._syntaxTable[t.line]&&i<this._syntaxTable[t.line].length&&t.column>this._syntaxTable[t.line][i].start;)i++;if(this._syntaxTable[t.line]){for(var n=this._syntaxTable[t.line].splice(i,this._syntaxTable[t.line].length-i),o=0;o<n.length;o++)n[o].start-=t.column-e.column;for(i=0;this._syntaxTable[e.line]&&i<this._syntaxTable[e.line].length&&e.column>this._syntaxTable[e.line][i].start;)i++;this._syntaxTable.splice(e.line+1,t.line-e.line),this._syntaxTable[e.line].splice(i,this._syntaxTable[e.line].length-i),this._syntaxTable[e.line]=this._syntaxTable[e.line].concat(n)}}},e.prototype.clearRange=function(t,e){if(t.line===e.line){var i=this._syntaxTable[t.line];if(i)for(var n=-1,o=0;o<i.length;o++)if(n===-1&&t.column>=i[o].start&&(n=o),n!==-1&&e.column>=i[o].start){this._syntaxTable[t.line].splice(n,o-n);break}}else{if(this._syntaxTable[t.line])for(var o=this._syntaxTable[t.line].length-1;o>=0;o--)this._syntaxTable[t.line][o].start>t.column&&this._syntaxTable[t.line].splice(o,1);for(var o=t.line+1;o<e.line;o++)this._syntaxTable[o]=[];if(this._syntaxTable[e.line])for(var o=this._syntaxTable[e.line].length-1;o>=0;o--)this._syntaxTable[e.line][o].start<e.column&&this._syntaxTable[e.line].splice(o,1)}},e.prototype.addRecord=function(e,i,n,o){if(this._syntaxTable[this._line]=this._syntaxTable[this._line]||[],this._index>0&&this._index-1<this._syntaxTable[this._line].length&&this._syntaxTable[this._line][this._index-1].start===this._column){var s=this._syntaxTable[this._line][this._index-1];s.style=n,null!==o&&(s.state=o)}else if(this._index<this._syntaxTable[this._line].length){var s=this._syntaxTable[this._line][this._index];e>=s.start?(s.start=e,s.style=n,s.state=o,this._index++):(this._syntaxTable[this._line].splice(this._index,0,new t.LanguageStyle(n,o,e)),this._index++)}else this._syntaxTable[this._line].push(new t.LanguageStyle(n,o,e)),this._index++;for(;this._line<i;)this._syntaxTable[this._line].splice(this._index,this._syntaxTable[this._line].length-this._index),this._line++,this._index=0,this.addRecord(0,this._line,n,null)},e.prototype.log=function(){for(var t=0;t<this._syntaxTable.length;t++){var e="line "+t+": ";if(this._syntaxTable[t]){e+="[ ";for(var i=0;i<this._syntaxTable[t].length;i++)e+=this._syntaxTable[t][i].start+this._syntaxTable[t][i].style[0]+(null!==this._syntaxTable[t][i].state?"X":"-")+" ";e+=" ]"}console.log(e)}return"-"},e}();t.LanguageService=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function t(t,e,i){this.style=t,this.state=e,this.start=i}return t}();t.LanguageStyle=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t}();t.Point=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function t(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}return t.prototype.union=function(e){var i=this.x<e.x?this.x:e.x,n=this.y<e.y?this.y:e.y,o=this.x+this.width<e.x+e.width?e.x+e.width:this.x+this.width,s=this.y+this.height<e.y+e.height?e.y+e.height:this.y+this.height;return new t(i,n,o-i,s-n)},t.prototype.toString=function(){return"("+this.x+","+this.y+")-("+this.width+","+this.height+")"},t}();t.Rectangle=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function t(t,e){this.oldRange=t,this.newRange=e}return t}();t.SelectionChangeEvent=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function t(t,e){this._textModel=t,this._redoTextRange=e,this._undoTextRange=this._textModel.getTextRange()}return t.prototype.undo=function(){this._textModel.selectRange(this._undoTextRange)},t.prototype.redo=function(){this._textModel.selectRange(this._redoTextRange)},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){if(e instanceof t){var i=e;return this._redoTextRange=i.redoTextRange,!0}return!1},t.prototype.toString=function(){return"Selection: "+this._redoTextRange.toString()+" => "+this._undoTextRange.toString()},Object.defineProperty(t.prototype,"redoTextRange",{get:function(){return this._redoTextRange},enumerable:!0,configurable:!0}),t}();t.SelectionUndoUnit=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function t(t,e){this.width=t,this.height=e}return t}();t.Size=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function e(){this._lines=[""],this._textChangingHandlers=[],this._textChangedHandlers=[]}return e.prototype.addEventListener=function(t,e){switch(t){case"textchanging":this._textChangingHandlers.push(e);break;case"textchanged":this._textChangedHandlers.push(e)}},e.prototype.removeEventListener=function(t,e){switch(t){case"textchanging":this._textChangingHandlers.remove(e);break;case"textchanged":this._textChangedHandlers.remove(e)}},e.prototype.setText=function(e,i){var n=i.split("\n"),o=n.length-1,s=new t.TextRange(e.start.clone(),new t.TextPosition(e.start.line+o,(1===n.length?e.start.column:0)+n[o].length));return n[0]=this._lines[e.start.line].substring(0,e.start.column)+n[0],n[o]=n[o]+this._lines[e.end.line].substring(e.end.column),this.onTextChanging(new t.TextChangeEvent(e,s,i)),this._lines=this._lines.slice(0,e.start.line).concat(n,this._lines.slice(e.end.line+1)),this.onTextChanged(new t.TextChangeEvent(e,s,i)),s},e.prototype.getText=function(t){if(t.start.line!==t.end.line){var e=[];return e.push(this._lines[t.start.line].substring(t.start.column)),e=e.concat(this._lines.slice(t.start.line+1,t.end.line)),e.push(this._lines[t.end.line].substring(0,t.end.column)),e.join("\n")}return this._lines[t.start.line].substring(t.start.column,t.end.column)},e.prototype.getTextRange=function(){return new t.TextRange(new t.TextPosition(0,0),new t.TextPosition(this._lines.length-1,this._lines[this._lines.length-1].length))},e.prototype.getLines=function(){return this._lines.length},e.prototype.getColumns=function(t){return this._lines[t].length},e.prototype.getLine=function(t){return this._lines[t]},e.prototype.onTextChanged=function(t){for(var e=0;e<this._textChangedHandlers.length;e++)this._textChangedHandlers[e](t)},e.prototype.onTextChanging=function(t){for(var e=0;e<this._textChangingHandlers.length;e++)this._textChangingHandlers[e](t)},e}();t.TextBuffer=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function t(t,e,i){this.oldRange=t,this.newRange=e,this.text=i}return t}();t.TextChangeEvent=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function e(t,e){var i=this;this._textEditor=t,this._canvas=e,this._isWebKit="undefined"!=typeof navigator.userAgent.split("WebKit/")[1],this._isChrome=navigator.userAgent.toLowerCase().indexOf("chrome")>-1,this._isMozilla=navigator.appVersion.indexOf("Gecko/")>=0||navigator.userAgent.indexOf("Gecko")>=0&&!this._isWebKit&&"undefined"!=typeof navigator.appVersion,this._isMac=/Mac/.test(navigator.userAgent),this._textArea=document.createElement("textarea"),this._textArea.style.position="absolute",this._textArea.style.top="0",this._textArea.style.left="0",this._textArea.style.width="0",this._textArea.style.height="0",this._textArea.style.zIndex="-99999",this._textArea.style.margin="0",this._textArea.style.border="0",this._textArea.style.padding="1px",this._textArea.style.resize="none",this._textArea.style.outline="none",this._textArea.style.overflow="hidden",this._textArea.style.background="none",this._textArea.value=".",document.body.appendChild(this._textArea),this.updateTextAreaPosition(),this._canvas_mouseDownHandler=function(t){i.canvas_mouseDown(t)},this._canvas_mouseWheelHandler=function(t){i.canvas_mouseWheel(t)},this._canvas_touchStartHandler=function(t){i.canvas_touchStart(t)},this._canvas_focusHandler=function(t){i.canvas_focus(t)},this._window_mouseUpHandler=function(t){i.window_mouseUp(t)},this._window_mouseMoveHandler=function(t){i.window_mouseMove(t)},this._canvas_touchEndHandler=function(t){i.canvas_touchEnd(t)},this._canvas_touchMoveHandler=function(t){i.canvas_touchMove(t)},this._textArea_keyUpHandler=function(t){i.textArea_keyUp(t)},this._textArea_keyDownHandler=function(t){i.textArea_keyDown(t)},this._textArea_keyPressHandler=function(t){i.textArea_keyPress(t)},this._textArea_focusHandler=function(t){i.textArea_focus(t)},this._textArea_blurHandler=function(t){i.textArea_blur(t)},this._textArea_cutHandler=function(t){i.textArea_cut(t)},this._textArea_copyHandler=function(t){i.textArea_copy(t)},this._textArea_pasteHandler=function(t){i.textArea_paste(t)},this._textArea_beforeCutHandler=function(t){i.textArea_beforeCut(t)},this._textArea_beforeCopyHandler=function(t){i.textArea_beforeCopy(t)},this._canvas.addEventListener("focus",this._canvas_focusHandler,!1),this._canvas.addEventListener("onmousewheel"in this._canvas?"mousewheel":"DOMMouseScroll",this._canvas_mouseWheelHandler,!1),this._canvas.addEventListener("touchstart",this._canvas_touchStartHandler,!1),this._canvas.addEventListener("touchmove",this._canvas_touchMoveHandler,!1),this._canvas.addEventListener("touchend",this._canvas_touchEndHandler,!1),this._canvas.addEventListener("mousedown",this._canvas_mouseDownHandler,!1),window.addEventListener("mousemove",this._window_mouseMoveHandler,!1),window.addEventListener("mouseup",this._window_mouseUpHandler,!1),this._textArea.addEventListener("focus",this._textArea_focusHandler,!1),this._textArea.addEventListener("blur",this._textArea_blurHandler,!1),this._textArea.addEventListener("cut",this._textArea_cutHandler,!1),this._textArea.addEventListener("copy",this._textArea_copyHandler,!1),this._textArea.addEventListener("paste",this._textArea_pasteHandler,!1),this._textArea.addEventListener("beforecut",this._textArea_beforeCutHandler,!1),this._textArea.addEventListener("beforecopy",this._textArea_beforeCopyHandler,!1),this._textArea.addEventListener("keydown",this._textArea_keyDownHandler,!1),this._textArea.addEventListener("keypress",this._textArea_keyPressHandler,!1),this._textArea.addEventListener("keyup",this._textArea_keyUpHandler,!1)}return e.prototype.dispose=function(){window.removeEventListener("mousemove",this._window_mouseMoveHandler),window.removeEventListener("mouseup",this._window_mouseUpHandler),this._canvas.removeEventListener("mousedown",this._canvas_mouseDownHandler),this._canvas.removeEventListener("touchend",this._canvas_touchEndHandler),this._canvas.removeEventListener("touchmove",this._canvas_touchMoveHandler),this._canvas.removeEventListener("touchstart",this._canvas_touchStartHandler),this._canvas.removeEventListener("focus",this._canvas_focusHandler),this._canvas.removeEventListener("onmousewheel"in this._canvas?"mousewheel":"DOMMouseScroll",this._canvas_mouseWheelHandler,!1),this._textArea.removeEventListener("focus",this._textArea_focusHandler),this._textArea.removeEventListener("blur",this._textArea_blurHandler),this._textArea.removeEventListener("cut",this._textArea_cutHandler),this._textArea.removeEventListener("copy",this._textArea_copyHandler),this._textArea.removeEventListener("paste",this._textArea_pasteHandler),this._textArea.removeEventListener("beforecut",this._textArea_beforeCutHandler),this._textArea.removeEventListener("beforecopy",this._textArea_beforeCopyHandler),this._textArea.removeEventListener("keypress",this._textArea_keyPressHandler),this._textArea.removeEventListener("keyup",this._textArea_keyUpHandler),this._textArea.removeEventListener("keydown",this._textArea_keyDownHandler)},e.prototype.isFocused=function(){return new RegExp("(^|\\s+)focus(\\s+|$)").test(this._canvas.className)},e.prototype.focus=function(){this._textArea.focus()},e.prototype.copy=function(t){(this._isMozilla||this._isWebKit)&&(this._textArea.value=t,this._textArea.select())},Object.defineProperty(e.prototype,"isMozilla",{get:function(){return this._isMozilla},enumerable:!0,configurable:!0}),e.prototype.textArea_cut=function(t){this._textEditor.cut()},e.prototype.textArea_copy=function(t){this._textEditor.copy()},e.prototype.textArea_paste=function(t){if(this._isMozilla)this._textArea.value="",window.setTimeout(function(){var t=this._textArea.value;t.length>0&&this._textEditor.paste(t)}.bind(this),1);else if(this._isWebKit){var e=t.clipboardData.getData("text/plain");this._textEditor.paste(e),this.stopEvent(t)}},e.prototype.textArea_beforeCut=function(t){this._textEditor.copy()},e.prototype.textArea_beforeCopy=function(t){this._textEditor.copy()},e.prototype.textArea_focus=function(t){this.isFocused()||(this._canvas.className+=" focus"),this._textArea.select(),this._textEditor.invalidate(),this._textEditor.update()},e.prototype.textArea_blur=function(t){this.isFocused()&&(this._canvas.className=this._canvas.className.replace(new RegExp(" focus\\b"),"")),this._textEditor.invalidate()},e.prototype.canvas_focus=function(t){this._textEditor.focus()},e.prototype.canvas_mouseDown=function(t){this._textEditor.focus(),this.stopEvent(t),this.updatePointerPosition(t.pageX,t.pageY);var e=this.getTextPosition(),i=(t.detail-1)%3+1;1===i?(t.shiftKey?this._textEditor.selectTo(e.line,e.column):this.pointerDown(),this._mouseCapture=!0,this.startScrollTimer()):2===i?(this._textEditor.selectWord(e.line,e.column),this._mouseCapture=!0,this.startScrollTimer()):3===i&&this._textEditor.selectRange(e.line,0,e.line+1,0),this.updateMouseCursor()},e.prototype.window_mouseUp=function(t){t.preventDefault(),this.updatePointerPosition(t.pageX,t.pageY),this.pointerUp()},e.prototype.window_mouseMove=function(t){t.preventDefault(),this.updatePointerPosition(t.pageX,t.pageY),this.pointerMove()},e.prototype.canvas_mouseWheel=function(t){t.preventDefault();var e=0;t||(e=window.event.wheelDelta/120),t.wheelDelta?e=t.wheelDelta/120:t.detail&&(e=-t.detail/3),0!==e&&(this._textEditor.scroll(Math.floor(-e),0),this._textEditor.update())},e.prototype.canvas_touchStart=function(t){this._textEditor.focus(),1===t.touches.length&&(t.preventDefault(),this.updatePointerPosition(t.touches[0].pageX,t.touches[0].pageY),this.pointerDown())},e.prototype.canvas_touchMove=function(t){1===t.touches.length&&(t.preventDefault(),this.updatePointerPosition(t.touches[0].pageX,t.touches[0].pageY),this.pointerMove())},e.prototype.canvas_touchEnd=function(t){t.preventDefault(),this.pointerUp()},e.prototype.textArea_keyUp=function(t){t.preventDefault()},e.prototype.textArea_keyDown=function(t){this._isMozilla||this.processKey(t.keyCode,t.shiftKey,t.ctrlKey,t.altKey,t.metaKey)&&(this._textEditor.update(),this.stopEvent(t))},e.prototype.textArea_keyPress=function(t){var e;if(this._isMozilla){if(!this._keyCodeTable){this._keyCodeTable=[];var i={32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:'"'};for(e in i){var n=i[e];this._keyCodeTable[n.charCodeAt(0)]=parseInt(e),n.toUpperCase()!=n&&(this._keyCodeTable[n.toUpperCase().charCodeAt(0)]=parseInt(e))}}if(e=0!==t.charCode&&this._keyCodeTable[t.charCode]?this._keyCodeTable[t.charCode]:t.keyCode,this.processKey(e,t.shiftKey,t.ctrlKey,t.altKey,t.metaKey))return this._textEditor.update(),void this.stopEvent(t)}if(t.ctrlKey==t.altKey&&!t.metaKey&&0!==t.charCode){this.stopEvent(t);var o=String.fromCharCode(t.charCode);this._textEditor.insertText(o),this._textEditor.updateScrollPosition(),this._textEditor.update()}},e.prototype.mouseScroll=function(){var t=this.getTextPosition();this._textEditor.selectTo(t.line,t.column),this._textEditor.updateScrollPosition(),this._textEditor.update()},e.prototype.mouseScroll_interval=function(){var t=this.getTextCoordinate(),e=this._textEditor.size;(t.line<0||t.line>=e.line||t.column<0||t.column>=e.column)&&this.mouseScroll()},e.prototype.pointerDown=function(){var t=this.getTextPosition();this._textEditor.select(t.line,t.column)},e.prototype.pointerMove=function(){this._mouseCapture&&this.mouseScroll(),this.updateMouseCursor()},e.prototype.pointerUp=function(){this._mouseCapture=!1,this.stopScrollTimer(),this.updateMouseCursor()},e.prototype.startScrollTimer=function(){this.stopScrollTimer(),this._scrollTimer=window.setInterval(this.mouseScroll_interval.bind(this),75)},e.prototype.stopScrollTimer=function(){null!==this._scrollTimer&&(window.clearInterval(this._scrollTimer),this._scrollTimer=null)},e.prototype.stopEvent=function(t){t.preventDefault(),t.stopPropagation()},e.prototype.updateMouseCursor=function(){this._canvas.style.cursor="text"},e.prototype.updateTextAreaPosition=function(){for(var e=new t.Point(0,0),i=this._canvas;null!==i;)e.x+=i.offsetLeft,e.y+=i.offsetTop,i=i.offsetParent;this._textArea.style.top=e.y+"px",this._textArea.style.left=e.x+"px"},e.prototype.updatePointerPosition=function(e,i){var n=this._textEditor.devicePixelRatio;this._pointerPosition=new t.Point(e*n,i*n);for(var o=this._canvas;null!==o;)this._pointerPosition.x-=o.offsetLeft*n,this._pointerPosition.y-=o.offsetTop*n,o=o.offsetParent},e.prototype.getTextCoordinate=function(){var e=this._pointerPosition.x+this._textEditor.fontSize.width/2,i=this._pointerPosition.y;return this._textEditor.getTextPosition(new t.Point(e,i))},e.prototype.getTextPosition=function(){var t=this.getTextCoordinate();return t.line+=this._textEditor.scrollPosition.line,t.column+=this._textEditor.scrollPosition.column,t},e.prototype.processKey=function(t,e,i,n,o){return this._isMac&&(!i||e||n||o?o&&37===t?(o=!1,t=36):o&&39===t&&(o=!1,t=35):65===t?(i=!1,t=36):69===t&&(i=!1,t=35)),this._textEditor.processKey(t,e,i,n,o)},e}();t.TextController=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function e(e){var i=this;this._undoService=new t.UndoService,this._textChangingHandlers=[],this._textChangedHandlers=[],this._selectionChangedHandlers=[],this._scrollPosition=new t.TextPosition(0,0),this._invalidRectangles=[],this._maxColumns=-1,this._blinkTimerEnabled=!1,this._blinkState=!0,this._canvas=e,this._context=e.getContext("2d"),this._textBuffer_textChanging=function(t){i.textBuffer_textChanging(t)},this._textBuffer_textChanged=function(t){i.textBuffer_textChanged(t)},this._textModel_selectionChanged=function(t){i.textModel_selectionChanged(t)},this._textBuffer=new t.TextBuffer,this._textBuffer.addEventListener("textchanging",this._textBuffer_textChanging),this._textBuffer.addEventListener("textchanged",this._textBuffer_textChanged),this._textModel=new t.TextModel(this._undoService,this._textBuffer),this._textModel.addEventListener("selectionchanged",this._textModel_selectionChanged),this._textModel.tabSize=4,this._textController=new t.TextController(this,this._canvas),this._languageService=new t.LanguageService(this),this._theme={fontFamily:"Menlo,Consolas,Courier New",fontSize:"13",paddingLeft:"4",paddingTop:"4",backgroundColor:"#ffffff",backgroundBlurColor:"#ffffff",selectionColor:"#c0ddf6",selectionBlurColor:"#e3f1fe",cursorColor:"#000000",cursorBackgroundColor:"#ededed",textStyle:"#000000",punctuationStyle:"#666666",commentStyle:"#0068c5 italic",keywordStyle:"#662266 bold",literalStyle:"#005a15",elementStyle:"#0000AA bold",attributeStyle:"#0000AA italic",errorStyle:"#FF0000 bold",declarationStyle:"#000000 bold"},this.updateSize(this._canvas.clientWidth,this._canvas.clientHeight),this.focus()}return e.prototype.dispose=function(){this._textController.dispose(),this._textController=null,this._textModel.removeEventListener("selectionchanged",this._textModel_selectionChanged),this._textBuffer.removeEventListener("textchanging",this._textBuffer_textChanging),this._textBuffer.removeEventListener("textchanged",this._textBuffer_textChanged),this._textChangedHandlers=[],this._selectionChangedHandlers=[]},e.prototype.addEventListener=function(t,e){switch(t){case"textchanging":this._textChangingHandlers.push(e);break;case"textchanged":this._textChangedHandlers.push(e);break;case"selectionchanged":this._selectionChangedHandlers.push(e)}},e.prototype.removeEventListener=function(t,e){switch(t){case"textchanging":this._textChangingHandlers.remove(e);break;case"textchanged":this._textChangedHandlers.remove(e);break;case"selectionchanged":this._selectionChangedHandlers.remove(e)}},Object.defineProperty(e.prototype,"theme",{get:function(){return this._theme},set:function(t){var e;for(e in t)this._theme[e]=t[e],"fontFamily"!==e&&"fontSize"!==e||this.updateFont();this.invalidate(),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"language",{get:function(){return this._languageService.language},set:function(t){this._languageService.language=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tabSize",{get:function(){return this._textModel.tabSize},set:function(t){this._textModel.tabSize=t,this.invalidate(),this.update()},enumerable:!0,configurable:!0}),e.prototype.focus=function(){this._textController.focus()},Object.defineProperty(e.prototype,"text",{get:function(){return this._textBuffer.getText(this._textBuffer.getTextRange())},set:function(e){this._undoService.begin(),this._undoService.add(new t.TextUndoUnit(this._textModel,this._textBuffer,this._textBuffer.getTextRange(),e)),this._undoService.add(new t.SelectionUndoUnit(this._textModel,new t.TextRange(new t.TextPosition(0,0),new t.TextPosition(0,0)))),this._undoService.commit(),this._undoService.clear(),this.update()},enumerable:!0,configurable:!0}),e.prototype.insertText=function(t){this._textModel.insertText(t)},e.prototype.deleteSelection=function(){this._textModel.deleteSelection(null)},e.prototype.select=function(e,i){e>this._textBuffer.getLines()-1&&(e=this._textBuffer.getLines()-1,i>this._textBuffer.getColumns(e)-1&&(i=this._textBuffer.getColumns(e)-1));var n=new t.TextPosition(e,i),o=this._textModel.toScreenPosition(this._textModel.toBufferPosition(n)),s=this._textModel.toScreenPosition(this._textModel.toBufferPosition(n));this._undoService.begin(),this._undoService.add(new t.SelectionUndoUnit(this._textModel,new t.TextRange(o,s))),this._undoService.commit(),this.updateScrollPosition(),this.update()},e.prototype.selectRange=function(e,i,n,o){this._undoService.begin(),this._undoService.add(new t.SelectionUndoUnit(this._textModel,new t.TextRange(new t.TextPosition(e,i),new t.TextPosition(n,o)))),this._undoService.commit(),this.updateScrollPosition(),this.update()},e.prototype.selectAll=function(){this._undoService.begin(),this._undoService.add(new t.SelectionUndoUnit(this._textModel,this._textModel.toScreenRange(this._textBuffer.getTextRange()))),this._undoService.commit(),this.update()},e.prototype.selectTo=function(e,i){var n=new t.TextPosition(e,i);n.line<0&&(n.line=0),n.line>=this._textBuffer.getLines()&&(n.line=this._textBuffer.getLines()-1),n.column<0&&(n.column=0),n=this._textModel.toScreenPosition(this._textModel.toBufferPosition(n)),this._textModel.textRange.end.equals(n)||(this._undoService.begin(),this._undoService.add(new t.SelectionUndoUnit(this._textModel,new t.TextRange(this._textModel.textRange.start.clone(),n))),this._undoService.commit(),this.updateScrollPosition(),this.update())},e.prototype.selectWord=function(e,i){var n=this._textModel.toBufferPosition(new t.TextPosition(e,i)),o=this._textBuffer.getLine(n.line),s=this._textModel.findWordBreak(o,n.column+1,-1),r=this._textModel.findWordBreak(o,n.column,1),a=new t.TextRange(new t.TextPosition(n.line,s),new t.TextPosition(n.line,r));this._undoService.begin(),this._undoService.add(new t.SelectionUndoUnit(this._textModel,this._textModel.toScreenRange(a))),this._undoService.commit(),this.update()},e.prototype.scroll=function(t,e){this._scrollPosition.line+=t,this._scrollPosition.column+=e;var i=this.size,n=this._textBuffer.getLines()-i.line<0?0:this._textBuffer.getLines()-i.line,o=this.getMaxColumns()-i.column+1<0?0:this.getMaxColumns()-i.column+1;this._scrollPosition.line<0&&(this._scrollPosition.line=0),this._scrollPosition.line>n&&(this._scrollPosition.line=n),this._scrollPosition.column<0&&(this._scrollPosition.column=0),this._scrollPosition.column>o&&(this._scrollPosition.column=o),this.invalidate()},Object.defineProperty(e.prototype,"scrollPosition",{get:function(){return this._scrollPosition},enumerable:!0,configurable:!0}),e.prototype.undo=function(){this._undoService.undo(),this.updateScrollPosition(),this.update()},e.prototype.redo=function(){this._undoService.redo(),this.updateScrollPosition(),this.update()},e.prototype.cut=function(){this.copy(),this.deleteSelection(),this.updateScrollPosition(),this.update()},e.prototype.copy=function(){var t=this._textModel.toBufferRange(this._textModel.getTextRange());if(!t.isEmpty){var e=this._textBuffer.getText(t);window.clipboardData&&window.clipboardData.getData?window.clipboardData.setData("Text",e):this._textController.copy(e)}},e.prototype.paste=function(t){t&&(this.insertText(t),this.updateScrollPosition(),this.update())},e.prototype.createTextReader=function(){return new t.TextReader(this._textBuffer)},e.prototype.processKey=function(t,e,i,n,o){if((i||o)&&!n){if(65===t)return this.selectAll(),!0;if(88===t){if(window.clipboardData&&window.clipboardData.setData)return this.cut(),!0}else if(67===t){if(window.clipboardData&&window.clipboardData.setData)return this.copy(),!0}else if(86===t){if(window.clipboardData&&window.clipboardData.getData){var s=window.clipboardData.getData("Text");if(s)return this.paste(s),!0}}else{if(90===t&&!e)return this.undo(),!0;if(90===t&&e||89===t)return this.redo(),!0}}if(!o&&!n){if(37===t)return this._textModel.moveCursor("column",i?"word":"1","previous",e),this.updateScrollPosition(),!0;if(39===t)return this._textModel.moveCursor("column",i?"word":"1","next",e),this.updateScrollPosition(),!0;if(38===t)return i?this.scroll(-1,0):(this._textModel.moveCursor("line","1","previous",e),this.updateScrollPosition()),!0;if(40===t)return i?this.scroll(1,0):(this._textModel.moveCursor("line","1","next",e),this.updateScrollPosition()),!0;if(!i){if(8===t)return this._textModel.deleteSelection("previous"),this.updateScrollPosition(),!0;if(9===t)return this.insertText("\t"),this.updateScrollPosition(),!0;if(13===t)return this.insertText("\n"+this._textModel.getIndent()),this.updateScrollPosition(),!0;if(45===t)return this._textModel.insertText(" "),this.updateScrollPosition(),!0;if(46===t)return this._textModel.deleteSelection("next"),this.updateScrollPosition(),!0;if(32===t)return this.insertText(" "),this.updateScrollPosition(),!0;if(33===t)return e?(this._textModel.moveCursor("line",this.size.line.toString(),"previous",e),this.updateScrollPosition()):this.scroll(-this.size.line,0),!0;if(34===t)return e?(this._textModel.moveCursor("line",this.size.line.toString(),"next",e),this.updateScrollPosition()):this.scroll(+this.size.line,0),!0;if(35===t)return this._textModel.moveCursor("column","boundary","next",e),this.updateScrollPosition(),!0;if(36===t)return this._textModel.moveCursor("column","boundary","previous",e),this.updateScrollPosition(),!0}}},e.prototype.updateScrollPosition=function(){var e=this.size;e.line--,e.column--;var i=this._textModel.textRange,n=i.end.clone();n.line>this._textBuffer.getLines()-1&&(n.line=this._textBuffer.getLines()-1);var o=this._textModel.toScreenPosition(new t.TextPosition(n.line,this._textBuffer.getColumns(n.line)));n.column>o.column-1&&(n.column=o.column-1),n.line-=this._scrollPosition.line,n.column-=this._scrollPosition.column;var s=0,r=0;if(n.line<0?s=n.line:n.line>e.line&&(s=n.line-e.line),n.column<5)r=n.column-5,this._scrollPosition.column+r<0&&(r=-this._scrollPosition.column);else if(n.column>e.column-5){r=n.column-e.column+5;var a=this.getMaxColumns();this._scrollPosition.column+r+e.column>a+1&&(r=a-e.column-this._scrollPosition.column+1)}0===r&&0===s||this.scroll(s,r);
},e.prototype.updateSize=function(t,e){this._canvas.style.width=t.toString(),this._canvas.style.height=e.toString(),this._canvas.width=t*this.devicePixelRatio,this._canvas.height=e*this.devicePixelRatio,this.updateFont(),this.invalidate(),this.update()},e.prototype.updateFont=function(){var e=parseFloat(this._theme.fontSize)*this.devicePixelRatio;this._context.font=e+"px "+this._theme.fontFamily;var i=this._context.measureText("XXXXXXXXXXXXXXXXXXXX").width/20,n=Math.floor(1.5*e);this._fontSize=new t.Size(i,n)},Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.getTextPosition(new t.Point(this._canvas.width,this._canvas.height))},enumerable:!0,configurable:!0}),e.prototype.getTextPosition=function(e){var i=parseFloat(this._theme.paddingLeft),n=parseFloat(this._theme.paddingTop),o=Math.floor((e.x-i)/this.fontSize.width),s=Math.floor((e.y-n)/this.fontSize.height);return new t.TextPosition(s,o)},Object.defineProperty(e.prototype,"devicePixelRatio",{get:function(){return"devicePixelRatio"in window&&window.devicePixelRatio>1?window.devicePixelRatio:"deviceXDPI"in window.screen&&"logicalXDPI"in window.screen?window.screen.deviceXDPI/window.screen.logicalXDPI:1},enumerable:!0,configurable:!0}),e.prototype.getMaxColumns=function(){if(this._maxColumns===-1)for(var t=0;t<this._textBuffer.getLines();t++){var e=this._textModel.getColumns(t);this._maxColumns<e&&(this._maxColumns=e)}return this._maxColumns},e.prototype.invalidate=function(){this.invalidateRectangle(new t.Rectangle(0,0,this._canvas.width,this._canvas.height))},e.prototype.invalidateSelection=function(e){this.invalidateRange(e);var i=(parseFloat(this._theme.paddingLeft),parseFloat(this._theme.paddingTop)),n=this.fontSize,o=new t.Rectangle(0,(e.end.line-this._scrollPosition.line)*n.height+i,this._canvas.width,n.height);this.invalidateRectangle(o)},e.prototype.invalidateRange=function(e){var i=this.fontSize,n=parseFloat(this._theme.paddingLeft),o=parseFloat(this._theme.paddingTop),s=e.normalize();s.start.line-=this._scrollPosition.line,s.end.line-=this._scrollPosition.line,s.start.column-=this._scrollPosition.column,s.end.column-=this._scrollPosition.column;var r=n,a=o+s.start.line*i.height;if(e.start.line===e.end.line){r+=s.start.column*i.width;var l=(s.end.column-s.start.column)*i.width;this.invalidateRectangle(new t.Rectangle(r,a,l,i.height))}else{var h=(s.end.line-s.start.line+1)*i.height;this.invalidateRectangle(new t.Rectangle(r,a,this._canvas.width,h))}},e.prototype.invalidateRectangle=function(t){t.x<0&&(t.x=0),t.y<0&&(t.y=0),t.x+t.width>this._canvas.width&&(t.width=this._canvas.width-t.x),t.y+t.height>this._canvas.height&&(t.height=this._canvas.height-t.y),this._invalidRectangles.push(t)},e.prototype.update=function(){if(0!==this._invalidRectangles.length){for(var t=this._invalidRectangles[0],e=1;e<this._invalidRectangles.length;e++)t=t.union(this._invalidRectangles[e]);if(0!==t.width&&0!==t.height){this._context.save(),this._context.beginPath(),this._context.rect(t.x,t.y,t.width,t.height),this._context.clip();var i=this._textController.isFocused();this._context.fillStyle=i?this._theme.backgroundColor:this._theme.backgroundBlurColor,this._context.fillRect(0,0,this._canvas.width,this._canvas.height);var n=this.size,o=this.fontSize,s=parseFloat(this._theme.paddingLeft),r=parseFloat(this._theme.paddingTop),a=this._textModel.getTextRange();if(a.start.line-=this._scrollPosition.line,a.end.line-=this._scrollPosition.line,a.start.column-=this._scrollPosition.column,a.end.column-=this._scrollPosition.column,this._textModel.isCursor()){this._context.fillStyle=this._theme.cursorBackgroundColor;var l=a.start.line*o.height+r;this._context.fillRect(0,l,this._canvas.width,o.height),this._blinkState&&this._textController.isFocused()&&(this._context.fillStyle=this._theme.cursorColor,this._context.fillRect(s+a.start.column*o.width,l,1,o.height))}else{this._context.fillStyle=i?this._theme.selectionColor:this._theme.selectionBlurColor;for(var l=0,h=0;h<n.line;h++){var u=0,c=this._canvas.width;h===a.start.line&&(u=a.start.column<0?0:a.start.column*o.width),h===a.end.line&&(c=a.end.column*o.width-u),h>=a.start.line&&h<=a.end.line&&c>0&&this._context.fillRect(u+s,l+r,c,o.height),l+=o.height}}var _={text:!0},d=["text"],x=this._context.font;this._context.shadowOffsetX=0,this._context.shadowOffsetY=0;for(var e=0;e<d.length;e++){var f=d[e],p=this._theme[f+"Style"],g=p.split(" ");this._context.fillStyle=g[0],this._context.font=2===g.length&&"italic"===g[1]?"italic "+x:x,this._context.font=2===g.length&&"bold"===g[1]?"bold "+x:x;for(var l=Math.floor(.8*o.height)+r,h=this._scrollPosition.line;h<this._scrollPosition.line+n.line;h++){if(h<this._textBuffer.getLines())for(var v=this._textBuffer.getLine(h),m=this._languageService.getStyles(h),y=0,T="text",b=0,w=0;w<v.length;){y<m.length&&(T=m[y].style,0!==e||_.hasOwnProperty(T)||(_[T]=!0,d.push(T)),y++);for(var P=y<m.length?m[y].start-w:v.length-w,S="",C=w;C<w+P;C++)S+="\t"!==v[C]?v[C]:this._textModel.tabText;f===T&&b-this._scrollPosition.column+S.length>0&&b-this._scrollPosition.column<n.column&&this._context.fillText(S,(b-this._scrollPosition.column)*o.width+s,l),w+=P,b+=S.length}l+=o.height}}this._context.restore()}this._invalidRectangles=[],this._textController.updateTextAreaPosition()}},e.prototype.textBuffer_textChanging=function(t){var e=this._textModel.toScreenRange(t.oldRange.normalize());e.end.column=this.size.column+this._scrollPosition.column,e.start.line!=e.end.line&&(e.end.line=this.size.line+this._scrollPosition.line),this.invalidateRange(e),this.onTextChanging(t)},e.prototype.textBuffer_textChanged=function(t){this._maxColumns=-1;var e=this._textModel.toScreenRange(t.newRange.normalize());e.end.column=this.size.column+this._scrollPosition.column,e.start.line!=e.end.line&&(e.end.line=this.size.line+this._scrollPosition.line),this.invalidateRange(e),this._languageService.invalidate(t.oldRange,t.newRange,t.text),this.onTextChanged(t)},e.prototype.textModel_selectionChanged=function(t){this.invalidateSelection(t.oldRange),this.invalidateSelection(t.newRange),this._blinkTimerEnabled&&(window.clearInterval(this._blinkTimer),this._blinkTimerEnabled=!1,this._blinkState=!0);var e=t.newRange.clone();e.isEmpty&&(this._blinkTimerEnabled=!0,this._blinkTimer=window.setInterval(function(){this.invalidateSelection(e),this.update(),this._blinkState=!this._blinkState}.bind(this),600)),this.onSelectionChanged(t)},e.prototype.onTextChanged=function(t){for(var e=0;e<this._textChangedHandlers.length;e++)this._textChangedHandlers[e](t)},e.prototype.onTextChanging=function(t){for(var e=0;e<this._textChangingHandlers.length;e++)this._textChangingHandlers[e](t)},e.prototype.onSelectionChanged=function(t){for(var e=0;e<this._selectionChangedHandlers.length;e++)this._selectionChangedHandlers[e](t)},e}();t.TextEditor=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function e(e,i){this._textRange=new t.TextRange(new t.TextPosition(0,0),new t.TextPosition(0,0)),this._selectionChangedHandlers=[],this._textBuffer=i,this._undoService=e}return e.prototype.addEventListener=function(t,e){switch(t){case"selectionchanged":this._selectionChangedHandlers.push(e)}},e.prototype.removeEventListener=function(t,e){switch(t){case"selectionchanged":this._selectionChangedHandlers.remove(e)}},Object.defineProperty(e.prototype,"textRange",{get:function(){return this._textRange},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tabText",{get:function(){return this._tabText},enumerable:!0,configurable:!0}),e.prototype.select=function(e){if(!e.equals(this._textRange.start)||!e.equals(this._textRange.end)){var i=this._textRange;this._textRange=new t.TextRange(new t.TextPosition(e.line,e.column),new t.TextPosition(e.line,e.column)),this.onSelectionChanged(new t.SelectionChangeEvent(i,this._textRange))}},e.prototype.selectRange=function(e){if(!e.start.equals(this._textRange.start)||!e.end.equals(this._textRange.end)){var i=this._textRange;this._textRange=e,this.onSelectionChanged(new t.SelectionChangeEvent(i,this._textRange))}},e.prototype.moveCursor=function(e,i,n,o){var s=this._textRange.end;if(o||(s="previous"===n?this.getTextRange().start:this.getTextRange().end,"line"===e&&(s.column="previous"===n?this._textRange.start.column:this._textRange.end.column)),s=this.toBufferPosition(s),"column"===e&&(o||this.isCursor())){if("boundary"===i){if("previous"!==n)s.column=this._textBuffer.getColumns(s.line);else for(var r=this._textBuffer.getLine(s.line),a=0;a<r.length;a++)if(" "!==r[a]&&"\t"!==r[a]){s.column=a===s.column?0:a;break}}else if("word"===i){var r=this._textBuffer.getLine(s.line);"previous"!==n&&s.column>=r.length?s.column++:"previous"===n&&0===s.column?s.column--:s.column=this.findWordBreak(r,s.column,"previous"==n?-1:1)}else s.column+="previous"===n?-Number(i):+Number(i);s.column<0&&(s.line--,s.line<0?(s.line=0,s.column=0):s.column=this._textBuffer.getColumns(s.line)),s.column>this._textBuffer.getColumns(s.line)&&(s.line++,s.column=0,s.line>=this._textBuffer.getLines()&&(s.line=this._textBuffer.getLines()-1,s.column=this._textBuffer.getColumns(s.line)))}"line"===e&&("boundrary"!==i&&(s.line+="previous"===n?-Number(i):+Number(i)),s.line<0?(s.line=0,s.column=0):s.line>this._textBuffer.getLines()-1&&(s.line=this._textBuffer.getLines()-1,s.column=this._textBuffer.getColumns(s.line))),s=this.toScreenPosition(s);var l=o?new t.TextRange(new t.TextPosition(this._textRange.start.line,this._textRange.start.column),s):new t.TextRange(s,s);this._undoService.begin(),this._undoService.add(new t.SelectionUndoUnit(this,l)),this._undoService.commit()},e.prototype.insertText=function(e){this._undoService.begin(),this._undoService.add(new t.TextUndoUnit(this,this._textBuffer,this.toBufferRange(this.getTextRange()),e)),this._undoService.commit()},e.prototype.deleteSelection=function(e){if(this.isCursor()&&null!==e){var i=this.toBufferRange(this.getTextRange());"previous"===e?(i.start.column--,i.start.column<0&&(i.start.line--,i.start.line<0?(i.start.line=0,i.start.column=0):i.start.column=this._textBuffer.getColumns(i.start.line))):"next"===e&&(i.end.column++,i.end.column>this._textBuffer.getColumns(i.end.line)&&(i.end.line++,i.end.line>this._textBuffer.getLines()-1?(i.end.line=this._textBuffer.getLines()-1,i.end.column=this._textBuffer.getColumns(i.end.line)):i.end.column=0)),this._undoService.begin(),this._undoService.add(new t.TextUndoUnit(this,this._textBuffer,i,"")),this._undoService.commit()}else this.insertText("")},e.prototype.getTextRange=function(){if(this.isCursor()){var e=this._textRange.start.line,i=this._textRange.start.column;return e>=this._textBuffer.getLines()?(e=this._textBuffer.getLines()-1,i=this.getColumns(e)):i>this.getColumns(e)&&(i=this.getColumns(e)),new t.TextRange(new t.TextPosition(e,i),new t.TextPosition(e,i))}var n=this._textRange.clone();return n.start.line>=this._textBuffer.getLines()&&(n.start.line=this._textBuffer.getLines()-1,n.start.column=this.getColumns(n.start.line)),n.end.line>=this._textBuffer.getLines()&&(n.end.line=this._textBuffer.getLines()-1,n.end.column=this.getColumns(n.end.line)),n.start.column>this.getColumns(n.start.line)&&(n.start=new t.TextPosition(n.start.line,this.getColumns(n.start.line))),n.end.column>this.getColumns(n.end.line)&&(n.end=new t.TextPosition(n.end.line,this.getColumns(n.end.line))),n.normalize()},e.prototype.isCursor=function(){return this._textRange.isEmpty},Object.defineProperty(e.prototype,"tabSize",{get:function(){return this._tabSize},set:function(t){this._tabSize=t,this._tabText="";for(var e=0;e<this._tabSize;e++)this._tabText+=" "},enumerable:!0,configurable:!0}),e.prototype.getColumns=function(t){return this.getTabLength(this._textBuffer.getLine(t))},e.prototype.getTabLength=function(t){for(var e=0,i=t.length,n=0;n<i;n++)e+="\t"===t[n]?this._tabSize:1;return e},e.prototype.toScreenPosition=function(e){var i=this._textBuffer.getLine(e.line).substring(0,e.column),n=this.getTabLength(i)-i.length;return new t.TextPosition(e.line,e.column+n)},e.prototype.toBufferPosition=function(e){for(var i=this._textBuffer.getLine(e.line),n=0,o=0;o<i.length;o++)if(n+="\t"===i[o]?this._tabSize:1,n>e.column)return new t.TextPosition(e.line,o);return new t.TextPosition(e.line,i.length)},e.prototype.toScreenRange=function(e){return new t.TextRange(this.toScreenPosition(e.start),this.toScreenPosition(e.end))},e.prototype.toBufferRange=function(e){return new t.TextRange(this.toBufferPosition(e.start),this.toBufferPosition(e.end))},e.prototype.getIndent=function(){var t=this.getTextRange();if(t.isEmpty){for(var e=this._textBuffer.getLine(t.end.line),i=0;i<e.length&&("\t"==e[i]||" "==e[i]);)i++;if(e=e.substring(0,i),t.end.column>=this.getTabLength(e))return e}return""},e.prototype.findWordBreak=function(t,e,i){i<0&&(e+=i);for(var n=this.isWordSeparator(t[e]),o=e;o>=0&&o<t.length;o+=i)if(this.isWordSeparator(t[o])!=n)return i<0?o-=i:o;return i<0?0:t.length},e.prototype.isWordSeparator=function(t){return" \t'\",;.!~@#$%^&*?=<>()[]:\\+-".indexOf(t)!==-1},e.prototype.onSelectionChanged=function(t){for(var e=0;e<this._selectionChangedHandlers.length;e++)this._selectionChangedHandlers[e](t)},e}();t.TextModel=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function t(t,e){this.line=t,this.column=e}return t.prototype.equals=function(t){return this.line===t.line&&this.column===t.column},t.prototype.compareTo=function(t){var e=this.line-t.line;return 0===e?this.column-t.column:e},t.prototype.clone=function(){return new t(this.line,this.column)},t.prototype.toString=function(){return"("+this.line+","+this.column+")"},t}();t.TextPosition=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function t(t,e){this.start=t,this.end=e}return Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this.start.line===this.end.line&&this.start.column===this.end.column},enumerable:!0,configurable:!0}),t.prototype.normalize=function(){return this.start.compareTo(this.end)>0?new t(this.end.clone(),this.start.clone()):this.clone()},t.prototype.clone=function(){return new t(this.start.clone(),this.end.clone())},t.prototype.toString=function(){return this.start.toString()+"-"+this.end.toString()},t}();t.TextRange=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function e(e){this._textPosition=new t.TextPosition(0,0),this._textBuffer=e,this.save()}return Object.defineProperty(e.prototype,"textPosition",{get:function(){return this._textPosition},enumerable:!0,configurable:!0}),e.prototype.peek=function(){if(this._textPosition.line<this._textBuffer.getLines()){var t=this._textBuffer.getLine(this._textPosition.line);return this._textPosition.column>=t.length?"\n":t[this._textPosition.column]}return""},e.prototype.read=function(){if(this._textPosition.line<this._textBuffer.getLines()){var t=this._textBuffer.getLine(this._textPosition.line),e=this._textPosition.column>=t.length?"\n":t[this._textPosition.column];return this._textPosition.column++,this._textPosition.column>t.length&&(this._textPosition.column=0,this._textPosition.line++),e}return""},e.prototype.match=function(t){for(var e=this._textPosition.line,i=this._textPosition.column,n=0;n<t.length;){var o=this.read();if(0===o.length||o!==t[n])return this._textPosition.line=e,this._textPosition.column=i,!1;n++}return!0},e.prototype.skipWhitespaces=function(){for(var t,e=!1;(t=this.peek()).length>0&&this.isWhitespace(t);)this.read(),e=!0;return e},e.prototype.skipLineTerminators=function(){for(var t,e=!1;(t=this.peek()).length>0;)if("\n"!==t){if("\r"!==t&&"\u2028"!==t&&"\u2029"!==t)break;this.read(),e=!0}else this.read(),"\r"===this.peek()&&this.read(),e=!0;return e},e.prototype.save=function(){this._lastLine=this._textPosition.line,this._lastColumn=this._textPosition.column},e.prototype.restore=function(){this._textPosition.line=this._lastLine,this._textPosition.column=this._lastColumn},e.prototype.isWhitespace=function(t){return" "===t||"\t"===t||" "===t},e}();t.TextReader=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function e(t,e,i,n){this._redoSelection=null,this._undoRange=null,this._textModel=t,this._textBuffer=e,this._redoRange=i,this._redoText=n,this._undoText=e.getText(i),this._undoSelection=t.getTextRange()}return e.prototype.undo=function(){this._textBuffer.setText(this._undoRange,this._undoText),this._textModel.selectRange(this._undoSelection)},e.prototype.redo=function(){if(this._undoRange=this._textBuffer.setText(this._redoRange,this._redoText),null===this._redoSelection){var e=this._textModel.toScreenPosition(this._undoRange.end);this._redoSelection=new t.TextRange(e.clone(),e.clone())}this._textModel.selectRange(this._redoSelection)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.merge=function(e){if(e instanceof t.SelectionUndoUnit){var i=e;return this._redoSelection=i.redoTextRange,!0}return!1},e.prototype.toString=function(){return"Text: "+this._undoRange.toString()+" => "+this._redoRange.toString()+" | '"+this._undoText.replace(/\t/g,"\\t")+"' => '"+this._redoText.replace(/\t/g,"\\t")+"' | "+this._undoSelection.toString()+" => "+this._redoSelection.toString()},e}();t.TextUndoUnit=e}(Textor||(Textor={}));var Textor;!function(t){var e=function(){function e(){this._container=null,this._stack=[],this._position=0}return e.prototype.begin=function(){this._container=new t.ContainerUndoUnit},e.prototype.cancel=function(){this._container=null},e.prototype.commit=function(){if(!this._container.isEmpty){this._stack.splice(this._position,this._stack.length-this._position),this._stack.push(this._container),this.redo();for(var t=this._stack[this._stack.length-1],e=t.undoUnits.length-1;e>0&&t.undoUnits[e-1].merge(t.undoUnits[e]);e--)t.undoUnits.splice(e,1);if(this._stack.length>1){var i=this._stack[this._stack.length-2];1===t.undoUnits.length&&i.undoUnits.length>0&&i.undoUnits[i.undoUnits.length-1].merge(t.undoUnits[0])&&(this._stack.splice(this._stack.length-1,1),this._position--)}}this._container=null},e.prototype.add=function(t){this._container.add(t)},e.prototype.clear=function(){this._stack=[],this._position=0},e.prototype.undo=function(){0!==this._position&&(this._position--,this._stack[this._position].undo())},e.prototype.redo=function(){0!==this._stack.length&&this._position<this._stack.length&&(this._stack[this._position].redo(),this._position++)},e.prototype.toString=function(){for(var t="",e=0;e<this._stack.length;e++)t+=this._stack[e].toString();return t},e}();t.UndoService=e}(Textor||(Textor={}));
//# sourceMappingURL=texteditor.js.map
