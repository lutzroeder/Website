var Textor;!function(t){var e=function(){function t(t){this._tokenStack=[],this._languages=t}return t.prototype.begin=function(t,e){if(this._textReader=t,this._tokenStack=[{type:this.readText}],this._languageToken=null,null!==e){var a=e.split(":");if(a.length>1){var i=a[0],n=a[1],s=this._languages[i];s&&(s.begin(this._textReader,a[2]),this.push({type:this.readLanguage,mimeType:i,language:s,closeTag:n,contentData:0}))}}},t.prototype.read=function(){return this._state=null,this._token=this._tokenStack[this._tokenStack.length-1],this._token.type===this.readLanguage?this._token.type.apply(this):{style:this._token.type.apply(this),state:this._state}},t.prototype.readText=function(){return this._textReader.match("<")?(1===this._tokenStack.length&&(this._state="base"),this._textReader.match("!")?this._textReader.match("--")?(this.push({type:this.readComment}),"comment"):this._textReader.match("[CDATA[")?(this.push({type:this.readConstantData}),"literal"):(this.push({type:this.readDocType}),"punctuation"):this._textReader.match("?")?(this.push({type:this.readProcessingInstruction}),"punctuation"):this._textReader.match("/")?(this.push({type:this.readEndTag}),"punctuation"):(this.push({type:this.readStartTag,name:"",hasAttributes:!1}),"punctuation")):this._textReader.match("&")?(this.push({type:this.readEntity}),"literal"):(this._textReader.read(),"text")},t.prototype.readStartTag=function(){if(this._textReader.skipWhitespaces())return this._token.hasAttributes=!0,this.push({type:this.readAttribute,name:"",hasValue:!1}),"text";if(this._textReader.match(">")||this._textReader.match("/>"))return this.pop(),this.setLanguage(),"punctuation";var t=this._textReader.read();return this._token.hasAttributes||(this._token.name+=t),"element"},t.prototype.readEndTag=function(){return this._textReader.match(">")?(this.pop(),"punctuation"):(this._token.name+=this._textReader.read(),"element")},t.prototype.readAttribute=function(){if(this._textReader.skipWhitespaces())return"text";if(this._textReader.match(">"))return this.pop(),this.pop(),this.setLanguage(),"punctuation";if(this._textReader.match("="))return this.push({type:this.readAttributeValue,value:"",quote:""}),this._token.hasValue=!0,"punctuation";var t=this._textReader.peek();return"/"===t?(this.pop(),"punctuation"):(this._textReader.read(),this._token.hasValue||(this._token.name+=t),"attribute")},t.prototype.readAttributeValue=function(){var t=this._textReader.peek();if(""===this._token.quote){if("'"===t)return this._textReader.read(),this._token.quote="s","literal";if('"'===t)return this._textReader.read(),this._token.quote="d","literal";if(this._textReader.skipWhitespaces())return"text";this._token.quote="-"}var e=!1,a="";if("s"===this._token.quote&&"'"===t?(this._textReader.read(),this.pop(),a="literal"):"d"===this._token.quote&&'"'===t?(this._textReader.read(),this.pop(),a="literal"):"-"===this._token.quote&&this._textReader.skipWhitespaces()?(this.pop(),a="text"):"-"===this._token.quote&&">"===t&&(this._textReader.read(),this.pop(),e=!0,a="punctuation"),0===a.length)return this._token.value+=this._textReader.read(),"literal";var i=this._tokenStack[this._tokenStack.length-1].name.toUpperCase(),n=this._tokenStack[this._tokenStack.length-2].name.toUpperCase();if("TYPE"===i&&"SCRIPT"===n||"TYPE"===i&&"STYLE"===n){var s=this._token.value,r=this._languages[s];r&&(r.begin(this._textReader,null),this._languageToken={type:this.readLanguage,mimeType:s,language:r,closeTag:"</"+n+">",contentData:0})}return this.pop(),e?(this.pop(),this.setLanguage()):this.push({type:this.readAttribute,name:"",value:!1}),a},t.prototype.readComment=function(){return this.terminate("-->"),"comment"},t.prototype.readConstantData=function(){return this.terminate("]]>"),"literal"},t.prototype.readEntity=function(){var t=this._textReader.read();return"\n"!==t&&";"!==t||this.pop(),"literal"},t.prototype.readDocType=function(){return this.terminate(">")?"punctuation":"element"},t.prototype.readProcessingInstruction=function(){return this.terminate("?>")?"punctuation":"literal"},t.prototype.readLanguage=function(){var t=this._textReader.peek();if(("<"===t||"]"===t)&&(this.testIgnoreCase("<![CDATA[")?this._token.contentData++:this.testIgnoreCase("]]>")&&this._token.contentData>0&&this._token.contentData--,0==this._token.contentData&&this.testIgnoreCase(this._token.closeTag)))return this.pop(),this.read();var e=this._token.language.read();return e.state=null!==e.state?this._token.mimeType+":"+this._token.closeTag+":"+e.state:null,e},t.prototype.push=function(t){this._tokenStack.push(t)},t.prototype.pop=function(){this._tokenStack.pop()},t.prototype.setLanguage=function(){null!==this._languageToken&&(this.push(this._languageToken),this._languageToken=null)},t.prototype.terminate=function(t){return this._textReader.match(t)?(this.pop(),!0):(this._textReader.read(),!1)},t.prototype.testIgnoreCase=function(t){this._textReader.save();for(var e=0;e<t.length;e++){var a=this._textReader.read();if(0===a.length||a.toUpperCase()!==t[e].toUpperCase())return this._textReader.restore(),!1}return this._textReader.restore(),!0},t}();t.HtmlLanguage=e}(Textor||(Textor={}));
//# sourceMappingURL=html.js.map
