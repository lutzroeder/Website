Array.prototype.remove=function(t){for(var e=this.length;e--;)this[e]==t&&this.splice(e,1)},Array.prototype.contains=function(t){for(var e=this.length;e--;)if(this[e]==t)return!0;return!1};var Netron;!function(t){var e=function(){function e(t,e){this._toPoint=null,this._from=t,this._to=e}return Object.defineProperty(e.prototype,"from",{get:function(){return this._from},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"to",{get:function(){return this._to},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected=t,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hover",{get:function(){return this._hover},set:function(t){this._hover=t},enumerable:!0,configurable:!0}),e.prototype.updateToPoint=function(t){this._toPoint=t},e.prototype.remove=function(){this.invalidate(),null!==this._from&&this._from.connections.contains(this)&&this._from.connections.remove(this),null!==this._to&&this._to.connections.contains(this)&&this._to.connections.remove(this),this._from=null,this._to=null},e.prototype.insert=function(t,e){this._from=t,this._to=e,this._from.connections.push(this),this._from.invalidate(),this._to.connections.push(this),this._to.invalidate(),this.invalidate()},e.prototype.getCursor=function(e){return t.Cursors.select},e.prototype.hitTest=function(e){if(null!==this.from&&null!==this.to){var n=this.from.element.getConnectorPosition(this.from),i=this.to.element.getConnectorPosition(this.to);if(0!==e.width||0!==e.height)return e.contains(n)&&e.contains(i);var o=e.topLeft;if(n.x>i.x){var r=i;i=n,n=r}var s=new t.Rectangle(n.x,n.y,0,0),h=new t.Rectangle(i.x,i.y,0,0);if(s.inflate(3,3),h.inflate(3,3),s.union(h).contains(o)){if(n.x==i.x||n.y==i.y)return!0;if(n.y<i.y){var c=s.x+(h.x-s.x)*(o.y-(s.y+s.height))/(h.y+h.height-(s.y+s.height)),a=s.x+s.width+(h.x+h.width-(s.x+s.width))*(o.y-s.y)/(h.y-s.y);return o.x>c&&o.x<a}var l=s.x+(h.x-s.x)*(o.y-s.y)/(h.y-s.y),u=s.x+s.width+(h.x+h.width-(s.x+s.width))*(o.y-(s.y+s.height))/(h.y+h.height-(s.y+s.height));return o.x>l&&o.x<u}}return!1},e.prototype.invalidate=function(){null!==this._from&&this._from.invalidate(),null!==this._to&&this._to.invalidate()},e.prototype.paint=function(t){t.strokeStyle=this._from.element.graph.theme.connection,t.lineWidth=this._hover?2:1,this.paintLine(t,this._selected)},e.prototype.paintTrack=function(t){t.strokeStyle=this.from.element.graph.theme.connection,t.lineWidth=1,this.paintLine(t,!0)},e.prototype.paintLine=function(e,n){if(null!==this._from){var i=this._from.element.getConnectorPosition(this.from),o=null!==this._to?this._to.element.getConnectorPosition(this.to):this._toPoint;i.x==o.x&&i.y==o.y||(e.beginPath(),n?t.LineHelper.dashedLine(e,i.x,i.y,o.x,o.y):(e.moveTo(i.x-.5,i.y-.5),e.lineTo(o.x-.5,o.y-.5)),e.closePath(),e.stroke())}},e}();t.Connection=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function e(t,e){this._connections=[],this._hover=!1,this._element=t,this._template=e}return e.prototype.getRectangle=function(){var e=this._element.getConnectorPosition(this),n=new t.Rectangle(e.x,e.y,0,0);return n.inflate(3,3),n},Object.defineProperty(e.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"template",{get:function(){return this._template},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connections",{get:function(){return this._connections},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hover",{get:function(){return this._hover},set:function(t){this._hover=t},enumerable:!0,configurable:!0}),e.prototype.getCursor=function(e){return t.Cursors.grip},e.prototype.hitTest=function(t){return 0===t.width&&0===t.height?this.getRectangle().contains(t.topLeft):t.contains(this.getRectangle().topLeft)},e.prototype.invalidate=function(){},e.prototype.isAssignable=function(t){if(t===this)return!1;var n=this._template.type.split(" ");if(!n.contains("[array]")&&1==this._connections.length)return!1;if(t instanceof e){var i=t._template.type.split(" ");if(n[0]!=i[0]||this._element==t.element||n.contains("[in]")&&!i.contains("[out]")||n.contains("[out]")&&!i.contains("[in]")||!i.contains("[array]")&&1==t.connections.length)return!1}return!0},e.prototype.paint=function(e,n){var i=this.getRectangle(),o=this._element.graph.theme.connectorBorder,r=this._element.graph.theme.connector;if(this._hover&&(o=this._element.graph.theme.connectorHoverBorder,r=this._element.graph.theme.connectorHover,this.isAssignable(n)||(r="#f00")),e.lineWidth=1,e.strokeStyle=o,e.lineCap="butt",e.fillStyle=r,e.fillRect(i.x-.5,i.y-.5,i.width,i.height),e.strokeRect(i.x-.5,i.y-.5,i.width,i.height),this._hover){var s="description"in this._template?this._template.description:this._template.name;e.textBaseline="bottom",e.font="8.25pt Tahoma";var h=e.measureText(s),c=14,a=h.width,l=new t.Rectangle(i.x-Math.floor(h.width/2),i.y+c+6,a,c),u=new t.Rectangle(l.x,l.y,l.width,l.height);l.inflate(4,1),e.fillStyle="rgb(255, 255, 231)",e.fillRect(l.x-.5,l.y-.5,l.width,l.height),e.strokeStyle="#000",e.lineWidth=1,e.strokeRect(l.x-.5,l.y-.5,l.width,l.height),e.fillStyle="#000",e.fillText(s,u.x,u.y+13)}},e}();t.Connector=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function t(){this._undoUnits=[]}return t.prototype.add=function(t){this._undoUnits.push(t)},t.prototype.undo=function(){for(var t=0;t<this._undoUnits.length;t++)this._undoUnits[t].undo()},t.prototype.redo=function(){for(var t=0;t<this._undoUnits.length;t++)this._undoUnits[t].redo()},Object.defineProperty(t.prototype,"isEmpty",{get:function(){if(this._undoUnits.length>0)for(var t=0;t<this._undoUnits.length;t++)if(!this._undoUnits[t].isEmpty)return!1;return!0},enumerable:!0,configurable:!0}),t}();t.ContainerUndoUnit=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function t(t,e){this._element=t,this._undoContent=t.content,this._redoContent=e}return t.prototype.undo=function(){this._element.content=this._undoContent},t.prototype.redo=function(){this._element.content=this._redoContent},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return!1},enumerable:!0,configurable:!0}),t}();t.ContentChangedUndoUnit=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function t(){}return t}();e.arrow="default",e.grip="pointer",e.cross="pointer",e.add="pointer",e.move="move",e.select="pointer",t.Cursors=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function t(t){this._connection=t,this._from=t.from,this._to=t.to}return t.prototype.undo=function(){this._connection.insert(this._from,this._to)},t.prototype.redo=function(){this._connection.remove()},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return!1},enumerable:!0,configurable:!0}),t}();t.DeleteConnectionUndoUnit=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function t(t){this._element=t,this._graph=t.graph}return t.prototype.undo=function(){this._element.insertInto(this._graph)},t.prototype.redo=function(){this._element.remove()},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return!1},enumerable:!0,configurable:!0}),t}();t.DeleteElementUndoUnit=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function e(e,n){this._graph=null,this._hover=!1,this._selected=!1,this._tracker=null,this._connectors=[],this._template=e,this._content=e.defaultContent,this._rectangle=new t.Rectangle(n.x,n.y,e.defaultWidth,e.defaultHeight);for(var i=0;i<e.connectorTemplates.length;i++){var o=e.connectorTemplates[i];this._connectors.push(new t.Connector(this,o))}}return Object.defineProperty(e.prototype,"rectangle",{get:function(){return null!==this._tracker&&this._tracker.track?this._tracker.rectangle:this._rectangle},set:function(t){this.invalidate(),this._rectangle=t,null!==this._tracker&&this._tracker.updateRectangle(t),this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"template",{get:function(){return this._template},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graph",{get:function(){return this._graph},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connectors",{get:function(){return this._connectors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tracker",{get:function(){return this._tracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(e){this._selected=e,this._selected?(this._tracker=new t.Tracker(this._rectangle,"resizable"in this._template&&this._template.resizable),this.invalidate()):(this.invalidate(),this._tracker=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hover",{get:function(){return this._hover},set:function(t){this._hover=t},enumerable:!0,configurable:!0}),e.prototype.paint=function(t){this._template.paint(this,t),this._selected&&this._tracker.paint(t)},e.prototype.invalidate=function(){},e.prototype.insertInto=function(t){this._graph=t,this._graph.elements.push(this)},e.prototype.remove=function(){this.invalidate();for(var t=0;t<this._connectors.length;t++)for(var e=this._connectors[t].connections,n=0;n<e.length;n++)e[n].remove();null!==this._graph&&this._graph.elements.contains(this)&&this._graph.elements.remove(this),this._graph=null},e.prototype.hitTest=function(t){if(0===t.width&&0===t.height){if(this._rectangle.contains(t.topLeft))return!0;if(null!==this._tracker&&this._tracker.track){var e=this._tracker.hitTest(t.topLeft);if(e.x>=-1&&e.x<=1&&e.y>=-1&&e.y<=1)return!0}for(var n=0;n<this._connectors.length;n++)if(this._connectors[n].hitTest(t))return!0;return!1}return t.contains(this._rectangle.topLeft)},e.prototype.getCursor=function(e){if(null!==this._tracker){var n=this._tracker.getCursor(e);if(null!==n)return n}return window.event.shiftKey?t.Cursors.add:t.Cursors.select},e.prototype.getConnector=function(t){for(var e=0;e<this._connectors.length;e++){var n=this._connectors[e];if(n.template.name==t)return n}return null},e.prototype.getConnectorPosition=function(t){var e=this.rectangle,n=t.template.getConnectorPosition(this);return n.x+=e.x,n.y+=e.y,n},e.prototype.setContent=function(t){this._graph.setElementContent(this,t)},Object.defineProperty(e.prototype,"content",{get:function(){return this._content},set:function(t){this._content=t},enumerable:!0,configurable:!0}),e}();t.Element=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function e(e){var n=this;this._pointerPosition=new t.Point(0,0),this._shiftKey=!1,this._undoService=new t.UndoService,this._elements=[],this._activeTemplate=null,this._activeObject=null,this._newElement=null,this._newConnection=null,this._selection=null,this._track=!1,this._canvas=e,this._canvas.width=this._canvas.clientWidth*this.devicePixelRatio,this._canvas.height=this._canvas.clientHeight*this.devicePixelRatio,this._canvas.focus(),this._context=this._canvas.getContext("2d"),this._context.scale(this.devicePixelRatio,this.devicePixelRatio),this._theme={background:"#fff",connection:"#000",selection:"#000",connector:"#31456b",connectorBorder:"#fff",connectorHoverBorder:"#000",connectorHover:"#0c0"},this._isWebKit="undefined"!=typeof navigator.userAgent.split("WebKit/")[1],this._isMozilla=navigator.appVersion.indexOf("Gecko/")>=0||navigator.userAgent.indexOf("Gecko")>=0&&!this._isWebKit&&"undefined"!=typeof navigator.appVersion,this._mouseDownHandler=function(t){n.mouseDown(t)},this._mouseUpHandler=function(t){n.mouseUp(t)},this._mouseMoveHandler=function(t){n.mouseMove(t)},this._doubleClickHandler=function(t){n.doubleClick(t)},this._touchStartHandler=function(t){n.touchStart(t)},this._touchEndHandler=function(t){n.touchEnd(t)},this._touchMoveHandler=function(t){n.touchMove(t)},this._keyDownHandler=function(t){n.keyDown(t)},this._keyPressHandler=function(t){n.keyPress(t)},this._keyUpHandler=function(t){n.keyUp(t)},this._canvas.addEventListener("mousedown",this._mouseDownHandler,!1),this._canvas.addEventListener("mouseup",this._mouseUpHandler,!1),this._canvas.addEventListener("mousemove",this._mouseMoveHandler,!1),this._canvas.addEventListener("touchstart",this._touchStartHandler,!1),this._canvas.addEventListener("touchend",this._touchEndHandler,!1),this._canvas.addEventListener("touchmove",this._touchMoveHandler,!1),this._canvas.addEventListener("dblclick",this._doubleClickHandler,!1),this._canvas.addEventListener("keydown",this._keyDownHandler,!1),this._canvas.addEventListener("keypress",this._keyPressHandler,!1),this._canvas.addEventListener("keyup",this._keyUpHandler,!1)}return e.prototype.dispose=function(){null!==this._canvas&&(this._canvas.removeEventListener("mousedown",this._mouseDownHandler),this._canvas.removeEventListener("mouseup",this._mouseUpHandler),this._canvas.removeEventListener("mousemove",this._mouseMoveHandler),this._canvas.removeEventListener("dblclick",this._doubleClickHandler),this._canvas.removeEventListener("touchstart",this._touchStartHandler),this._canvas.removeEventListener("touchend",this._touchEndHandler),this._canvas.removeEventListener("touchmove",this._touchMoveHandler),this._canvas.removeEventListener("keydown",this._keyDownHandler),this._canvas.removeEventListener("keypress",this._keyPressHandler),this._canvas.removeEventListener("keyup",this._keyUpHandler),this._canvas=null,this._context=null)},Object.defineProperty(e.prototype,"theme",{get:function(){return this._theme},set:function(t){this._theme=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elements",{get:function(){return this._elements},enumerable:!0,configurable:!0}),e.prototype.addElement=function(e,n,i){this._activeTemplate=e;var o=new t.Element(e,n);return o.content=i,o.insertInto(this),o.invalidate(),o},e.prototype.createElement=function(e){this._activeTemplate=e,this._newElement=new t.Element(e,this._pointerPosition),this.update(),this._canvas.focus()},e.prototype.addConnection=function(e,n){var i=new t.Connection(e,n);return e.connections.push(i),n.connections.push(i),e.invalidate(),n.invalidate(),i.invalidate(),i},e.prototype.setElementContent=function(e,n){this._undoService.begin(),this._undoService.add(new t.ContentChangedUndoUnit(e,n)),this._undoService.commit(),this.update()},e.prototype.deleteSelection=function(){this._undoService.begin();for(var e=[],n=0;n<this._elements.length;n++)for(var i=this._elements[n],o=0;o<i.connectors.length;o++)for(var r=i.connectors[o],s=0;s<r.connections.length;s++){var h=r.connections[s];!i.selected&&!h.selected||e.contains(h)||(this._undoService.add(new t.DeleteConnectionUndoUnit(h)),e.push(h))}for(var n=0;n<this._elements.length;n++){var i=this._elements[n];i.selected&&this._undoService.add(new t.DeleteElementUndoUnit(i))}this._undoService.commit()},Object.defineProperty(e.prototype,"devicePixelRatio",{get:function(){return"devicePixelRatio"in window&&window.devicePixelRatio>1?window.devicePixelRatio:1},enumerable:!0,configurable:!0}),e.prototype.mouseDown=function(t){t.preventDefault(),this._canvas.focus(),this.updateMousePosition(t),0===t.button&&(null===this._newElement&&t.altKey&&this.createElement(this._activeTemplate),this.pointerDown())},e.prototype.mouseUp=function(t){t.preventDefault(),this.updateMousePosition(t),0===t.button&&this.pointerUp()},e.prototype.mouseMove=function(t){t.preventDefault(),this.updateMousePosition(t),this.pointerMove()},e.prototype.doubleClick=function(e){if(e.preventDefault(),this.updateMousePosition(e),0===e.button){var n=this._pointerPosition;if(this.updateActiveObject(n),null!==this._activeObject&&this._activeObject instanceof t.Element){var i=this._activeObject;null!==i.template&&"edit"in i.template&&(i.template.edit(i,this._context,n),this.update())}}},e.prototype.touchStart=function(t){1==t.touches.length&&(t.preventDefault(),this.updateTouchPosition(t),this.pointerDown())},e.prototype.touchEnd=function(t){t.preventDefault(),this.pointerUp()},e.prototype.touchMove=function(t){1==t.touches.length&&(t.preventDefault(),this.updateTouchPosition(t),this.pointerMove())},e.prototype.pointerDown=function(){var e=this._pointerPosition;if(null!==this._newElement)this._undoService.begin(),this._newElement.invalidate(),this._newElement.rectangle=new t.Rectangle(e.x,e.y,this._newElement.rectangle.width,this._newElement.rectangle.height),this._newElement.invalidate(),this._undoService.add(new t.InsertElementUndoUnit(this._newElement,this)),this._undoService.commit(),this._newElement=null;else if(this._selection=null,this.updateActiveObject(e),null===this._activeObject)this._selection=new t.Selection(e);else if(this._activeObject instanceof t.Connector&&!this._shiftKey){var n=this._activeObject;n.isAssignable(null)&&(this._newConnection=new t.Connection(n,null),this._newConnection.updateToPoint(e),n.invalidate())}else{var i=this._activeObject;if(i.selected){if(this._shiftKey){this._undoService.begin();var o=new t.SelectionUndoUnit;o.deselect(i),this._undoService.add(o),this._undoService.commit()}}else{this._undoService.begin();var r=new t.SelectionUndoUnit;this._shiftKey||this.deselectAll(r),r.select(i),this._undoService.add(r),this._undoService.commit()}var s=new t.Point(0,0);if(this._activeObject instanceof t.Element){var h=this._activeObject;s=h.tracker.hitTest(e)}for(var c=0;c<this._elements.length;c++){var h=this._elements[c];null!==h.tracker&&h.tracker.start(e,s)}this._track=!0}this.update(),this.updateMouseCursor()},e.prototype.pointerUp=function(){var e=this._pointerPosition;if(null!==this._newConnection){if(this.updateActiveObject(e),this._newConnection.invalidate(),null!==this._activeObject&&this._activeObject instanceof t.Connector){var n=this._activeObject;n!=this._newConnection.from&&n.isAssignable(this._newConnection.from)&&(this._undoService.begin(),this._undoService.add(new t.InsertConnectionUndoUnit(this._newConnection,this._newConnection.from,n)),this._undoService.commit())}this._newConnection=null}if(null!==this._selection){this._undoService.begin();var i=new t.SelectionUndoUnit,o=this._selection.rectangle,r=this._activeObject;null!==this._activeObject&&r.selected||this._shiftKey||this.deselectAll(i),0===o.width&&0===o.height||this.selectAll(i,o),this._undoService.add(i),this._undoService.commit(),this._selection=null}if(this._track){this._undoService.begin();for(var s=0;s<this._elements.length;s++){var h=this._elements[s];if(null!==h.tracker){h.tracker.stop(),h.invalidate();var c=h.rectangle,a=h.tracker.rectangle;c.x==a.x&&c.y==a.y&&c.width==a.width&&c.height==a.height||this._undoService.add(new t.TransformUndoUnit(h,c,a))}}this._undoService.commit(),this._track=!1,this.updateActiveObject(e)}this.update(),this.updateMouseCursor()},e.prototype.pointerMove=function(){var e=this._pointerPosition;if(null!==this._newElement&&(this._newElement.invalidate(),this._newElement.rectangle=new t.Rectangle(e.x,e.y,this._newElement.rectangle.width,this._newElement.rectangle.height),this._newElement.invalidate()),this._track)for(var n=0;n<this._elements.length;n++){var i=this._elements[n];null!==i.tracker&&(i.invalidate(),i.tracker.move(e),i.invalidate())}null!==this._newConnection&&(this._newConnection.invalidate(),this._newConnection.updateToPoint(e),this._newConnection.invalidate()),null!==this._selection&&this._selection.updateCurrentPoint(e),this.updateActiveObject(e),this.update(),this.updateMouseCursor()},e.prototype.keyDown=function(t){this._isMozilla||this.processKey(t,t.keyCode)},e.prototype.keyPress=function(t){if(this._isMozilla){if("undefined"==typeof this._keyCodeTable){this._keyCodeTable=[];var e={32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:'"'};for(var n in e){var i=e[n];this._keyCodeTable[i.charCodeAt(0)]=n,i.toUpperCase()!=i&&(this._keyCodeTable[i.toUpperCase().charCodeAt(0)]=n)}}this.processKey(t,this._keyCodeTable[t.charCode]?this._keyCodeTable[t.charCode]:t.keyCode)}},e.prototype.keyUp=function(t){this.updateMouseCursor()},e.prototype.processKey=function(e,n){if((e.ctrlKey||e.metaKey)&&!e.altKey){if(65==n){this._undoService.begin();var i=new t.SelectionUndoUnit;this.selectAll(i,null),this._undoService.add(i),this._undoService.commit(),this.update(),this.updateActiveObject(this._pointerPosition),this.updateMouseCursor(),this.stopEvent(e)}90!=n||e.shiftKey||(this._undoService.undo(),this.update(),this.updateActiveObject(this._pointerPosition),this.updateMouseCursor(),this.stopEvent(e)),(90==n&&e.shiftKey||89==n)&&(this._undoService.redo(),this.update(),this.updateActiveObject(this._pointerPosition),this.updateMouseCursor(),this.stopEvent(e))}if(46!=n&&8!=n||(this.deleteSelection(),this.update(),this.updateActiveObject(this._pointerPosition),this.updateMouseCursor(),this.stopEvent(e)),27==n){this._newElement=null,this._newConnection=null,this._track=!1;for(var o=0;o<this._elements.length;o++){var r=this._elements[o];null!==r.tracker&&r.tracker.stop()}this.update(),this.updateActiveObject(this._pointerPosition),this.updateMouseCursor(),this.stopEvent(e)}},e.prototype.stopEvent=function(t){t.preventDefault(),t.stopPropagation()},e.prototype.selectAll=function(t,e){for(var n=0;n<this._elements.length;n++){var i=this._elements[n];(null===e||i.hitTest(e))&&t.select(i);for(var o=0;o<i.connectors.length;o++)for(var r=i.connectors[o],s=0;s<r.connections.length;s++){var h=r.connections[s];(null===e||h.hitTest(e))&&t.select(h)}}},e.prototype.deselectAll=function(t){for(var e=0;e<this._elements.length;e++){var n=this._elements[e];t.deselect(n);for(var i=0;i<n.connectors.length;i++)for(var o=n.connectors[i],r=0;r<o.connections.length;r++){var s=o.connections[r];t.deselect(s)}}},e.prototype.updateActiveObject=function(t){var e=this.hitTest(t);e!=this._activeObject&&(null!==this._activeObject&&(this._activeObject.hover=!1),this._activeObject=e,null!==this._activeObject&&(this._activeObject.hover=!0))},e.prototype.hitTest=function(e){for(var n=new t.Rectangle(e.x,e.y,0,0),i=0;i<this._elements.length;i++)for(var o=this._elements[i],r=0;r<o.connectors.length;r++){var s=o.connectors[r];if(s.hitTest(n))return s}for(var i=0;i<this._elements.length;i++){var o=this._elements[i];if(o.hitTest(n))return o}for(var i=0;i<this._elements.length;i++)for(var o=this._elements[i],r=0;r<o.connectors.length;r++)for(var s=o.connectors[r],h=0;h<s.connections.length;h++){var c=s.connections[h];if(c.hitTest(n))return c}return null},e.prototype.updateMouseCursor=function(){null!==this._newConnection?this._canvas.style.cursor=null!==this._activeObject&&this._activeObject instanceof t.Connector?this._activeObject.getCursor(this._pointerPosition):t.Cursors.cross:this._canvas.style.cursor=null!==this._activeObject?this._activeObject.getCursor(this._pointerPosition):t.Cursors.arrow},e.prototype.updateMousePosition=function(e){this._shiftKey=e.shiftKey,this._pointerPosition=new t.Point(e.pageX,e.pageY);for(var n=this._canvas;null!==n;)this._pointerPosition.x-=n.offsetLeft,this._pointerPosition.y-=n.offsetTop,n=n.offsetParent},e.prototype.updateTouchPosition=function(e){this._shiftKey=!1,this._pointerPosition=new t.Point(e.touches[0].pageX,e.touches[0].pageY);for(var n=this._canvas;null!==n;)this._pointerPosition.x-=n.offsetLeft,this._pointerPosition.y-=n.offsetTop,n=n.offsetParent},e.prototype.update=function(){this._canvas.style.background=this.theme.background,this._context.clearRect(0,0,this._canvas.width,this._canvas.height);for(var t=[],e=0;e<this._elements.length;e++)for(var n=this._elements[e],i=0;i<n.connectors.length;i++)for(var o=n.connectors[i],r=0;r<o.connections.length;r++){var s=o.connections[r];t.contains(s)||(s.paint(this._context),t.push(s))}for(var e=0;e<this._elements.length;e++)this._context.save(),this._elements[e].paint(this._context),this._context.restore();for(var e=0;e<this._elements.length;e++)for(var n=this._elements[e],i=0;i<n.connectors.length;i++){for(var o=n.connectors[i],h=!1,r=0;r<o.connections.length;r++)o.connections[r].hover&&(h=!0);n.hover||o.hover||h?o.paint(this._context,null!==this._newConnection?this._newConnection.from:null):null!==this._newConnection&&o.isAssignable(this._newConnection.from)&&o.paint(this._context,this._newConnection.from)}null!==this._newElement&&(this._context.save(),this._newElement.paint(this._context),this._context.restore()),null!==this._newConnection&&this._newConnection.paintTrack(this._context),null!==this._selection&&(this._context.strokeStyle=this.theme.selection,this._selection.paint(this._context))},e}();t.Graph=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function t(t,e,n){this._connection=t,this._from=e,this._to=n}return t.prototype.undo=function(){this._connection.remove()},t.prototype.redo=function(){this._connection.insert(this._from,this._to)},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return!1},enumerable:!0,configurable:!0}),t}();t.InsertConnectionUndoUnit=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function t(t,e){this._element=t,this._graph=e}return t.prototype.undo=function(){this._element.remove()},t.prototype.redo=function(){this._element.insertInto(this._graph)},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return!1},enumerable:!0,configurable:!0}),t}();t.InsertElementUndoUnit=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function t(){}return t.dashedLine=function(t,e,n,i,o){t.moveTo(e,n);for(var r=i-e,s=o-n,h=Math.floor(Math.sqrt(r*r+s*s)/3),c=r/h,a=s/h,l=0;l++<h;)e+=c,n+=a,l%2===0?t.moveTo(e,n):t.lineTo(e,n);l%2===0?t.moveTo(i,o):t.lineTo(i,o)},t}();t.LineHelper=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function t(t,e){this.x=t,this.y=e}return t}();t.Point=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function e(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}return e.prototype.contains=function(t){return t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height},e.prototype.inflate=function(t,e){this.x-=t,this.y-=e,this.width+=t+t+1,this.height+=e+e+1},e.prototype.union=function(t){var n=this.x<t.x?this.x:t.x,i=this.y<t.y?this.y:t.y,o=this.x+this.width<t.x+t.width?t.x+t.width:this.x+this.width,r=this.y+this.height<t.y+t.height?t.y+t.height:this.y+this.height;return new e(n,i,o-n,r-i)},Object.defineProperty(e.prototype,"topLeft",{get:function(){return new t.Point(this.x,this.y)},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e}();t.Rectangle=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function e(t){this._startPoint=t,this._currentPoint=t}return Object.defineProperty(e.prototype,"rectangle",{get:function(){var e=new t.Rectangle(this._startPoint.x<=this._currentPoint.x?this._startPoint.x:this._currentPoint.x,this._startPoint.y<=this._currentPoint.y?this._startPoint.y:this._currentPoint.y,this._currentPoint.x-this._startPoint.x,this._currentPoint.y-this._startPoint.y);return e.width<0&&(e.width*=-1),e.height<0&&(e.height*=-1),e},enumerable:!0,configurable:!0}),e.prototype.updateCurrentPoint=function(t){this._currentPoint=t},e.prototype.paint=function(e){var n=this.rectangle;e.lineWidth=1,e.beginPath(),t.LineHelper.dashedLine(e,n.x-.5,n.y-.5,n.x-.5+n.width,n.y-.5),t.LineHelper.dashedLine(e,n.x-.5+n.width,n.y-.5,n.x-.5+n.width,n.y-.5+n.height),t.LineHelper.dashedLine(e,n.x-.5+n.width,n.y-.5+n.height,n.x-.5,n.y-.5+n.height),t.LineHelper.dashedLine(e,n.x-.5,n.y-.5+n.height,n.x-.5,n.y-.5),e.closePath(),e.stroke()},e}();t.Selection=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function t(){this._states=[]}return t.prototype.undo=function(){for(var t=0;t<this._states.length;t++)this._states[t].value.selected=this._states[t].undo},t.prototype.redo=function(){for(var t=0;t<this._states.length;t++)this._states[t].value.selected=this._states[t].redo},Object.defineProperty(t.prototype,"isEmpty",{get:function(){for(var t=0;t<this._states.length;t++)if(this._states[t].undo!=this._states[t].redo)return!1;return!0},enumerable:!0,configurable:!0}),t.prototype.select=function(t){this.update(t,t.selected,!0)},t.prototype.deselect=function(t){this.update(t,t.selected,!1)},t.prototype.update=function(t,e,n){for(var i=0;i<this._states.length;i++)if(this._states[i].value==t)return void(this._states[i].redo=n);this._states.push({value:t,undo:e,redo:n})},t}();t.SelectionUndoUnit=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function e(t,e){this._track=!1,this._rectangle=t.clone(),this._resizable=e}return Object.defineProperty(e.prototype,"rectangle",{get:function(){return this._rectangle},enumerable:!0,configurable:!0}),e.prototype.hitTest=function(e){if(this._resizable)for(var n=-1;n<=1;n++)for(var i=-1;i<=1;i++)if(0!==n||0!==i){var o=new t.Point(n,i);if(this.getGripRectangle(o).contains(e))return o}return this._rectangle.contains(e)?new t.Point(0,0):new t.Point(-2,-2)},e.prototype.getGripRectangle=function(e){var n=new t.Rectangle(0,0,7,7);return e.x<0&&(n.x=this._rectangle.x-7),0===e.x&&(n.x=this._rectangle.x+Math.floor(this._rectangle.width/2)-3),e.x>0&&(n.x=this._rectangle.x+this._rectangle.width+1),e.y<0&&(n.y=this._rectangle.y-7),0===e.y&&(n.y=this._rectangle.y+Math.floor(this._rectangle.height/2)-3),e.y>0&&(n.y=this._rectangle.y+this._rectangle.height+1),n},e.prototype.getCursor=function(e){var n=this.hitTest(e);if(0===n.x&&0===n.y)return this._track?t.Cursors.move:t.Cursors.select;if(n.x>=-1&&n.x<=1&&n.y>=-1&&n.y<=1&&this._resizable){if(n.x===-1&&n.y===-1)return"nw-resize";if(1===n.x&&1===n.y)return"se-resize";if(n.x===-1&&1===n.y)return"sw-resize";if(1===n.x&&n.y===-1)return"ne-resize";if(0===n.x&&n.y===-1)return"n-resize";if(0===n.x&&1===n.y)return"s-resize";if(1===n.x&&0===n.y)return"e-resize";if(n.x===-1&&0===n.y)return"w-resize"}return null},e.prototype.start=function(t,e){e.x>=-1&&e.x<=1&&e.y>=-1&&e.y<=1&&(this._handle=e,this._currentPoint=t,this._track=!0)},e.prototype.stop=function(){this._track=!1},Object.defineProperty(e.prototype,"track",{get:function(){return this._track},enumerable:!0,configurable:!0}),e.prototype.move=function(e){var n=this._handle,i=new t.Point(0,0),o=new t.Point(0,0);(n.x==-1||0===n.x&&0===n.y)&&(i.x=e.x-this._currentPoint.x),(n.y==-1||0===n.x&&0===n.y)&&(i.y=e.y-this._currentPoint.y),(1==n.x||0===n.x&&0===n.y)&&(o.x=e.x-this._currentPoint.x),(1==n.y||0===n.x&&0===n.y)&&(o.y=e.y-this._currentPoint.y);var r=new t.Point(this._rectangle.x,this._rectangle.y),s=new t.Point(this._rectangle.x+this._rectangle.width,this._rectangle.y+this._rectangle.height);r.x+=i.x,r.y+=i.y,s.x+=o.x,s.y+=o.y,this._rectangle.x=r.x,this._rectangle.y=r.y,this._rectangle.width=s.x-r.x,this._rectangle.height=s.y-r.y,this._currentPoint=e},e.prototype.updateRectangle=function(t){this._rectangle=t.clone()},e.prototype.paint=function(e){if(this._resizable)for(var n=-1;n<=1;n++)for(var i=-1;i<=1;i++)if(0!==n||0!==i){var o=this.getGripRectangle(new t.Point(n,i));e.fillStyle="#ffffff",e.strokeStyle="#000000",e.lineWidth=1,e.fillRect(o.x-.5,o.y-.5,o.width-1,o.height-1),e.strokeRect(o.x-.5,o.y-.5,o.width-1,o.height-1)}},e}();t.Tracker=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function t(t,e,n){this._element=t,this._undoRectangle=e.clone(),this._redoRectangle=n.clone()}return t.prototype.undo=function(){this._element.rectangle=this._undoRectangle},t.prototype.redo=function(){this._element.rectangle=this._redoRectangle},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return!1},enumerable:!0,configurable:!0}),t}();t.TransformUndoUnit=e}(Netron||(Netron={}));var Netron;!function(t){var e=function(){function e(){this._container=null,this._stack=[],this._position=0}return e.prototype.begin=function(){
this._container=new t.ContainerUndoUnit},e.prototype.cancel=function(){this._container=null},e.prototype.commit=function(){this._container.isEmpty||(this._stack.splice(this._position,this._stack.length-this._position),this._stack.push(this._container),this.redo()),this._container=null},e.prototype.add=function(t){this._container.add(t)},e.prototype.undo=function(){0!==this._position&&(this._position--,this._stack[this._position].undo())},e.prototype.redo=function(){0!==this._stack.length&&this._position<this._stack.length&&(this._stack[this._position].redo(),this._position++)},e}();t.UndoService=e}(Netron||(Netron={}));
//# sourceMappingURL=netron.js.map
